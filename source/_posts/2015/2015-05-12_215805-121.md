---
title: C++ new关键字的返回值
tags:
  - 进程空间
id: '121'
categories:
  - - language
    - C/C++
date: 2015-05-12 21:58:05
---

在C中，我们申请一块内存时，往往会根据malloc的返回值来判断是否为NULL而判定是否申请内存成功，但C++中，new关键字并不像malloc一样是有返回值的。所以以下语法是没有意义的语法。
<!-- more -->
int\* p = new int(5);
if (NULL == p) return -1;

因为new关键字默认情况下是没有返回值的，如果申请失败，new关键字会抛出异常（以后会介绍）。既然没有返回值，难道我们就无法判断new是否申请成功吗？当然不是，想判断new是否申请成功，有两种方式。

1.  使用new关键字时让其不抛出异常而真正有返回值
2.  通过捕获异常判断是否申请成功（以后介绍）

我们只介绍一下第一种方法，捕获异常的版本我们会在专门讲异常的地方给出示例。如果想让new关键字不抛出异常，只需要在申请内存时，增加一句话即可。如下所示：

//C++ 内存申请失败不抛出异常版本
int \*q = new (std::nothrow)int\[10\];
if(q == NULL) return -1;

在new后面增加(std::nothrow)以后，new不再抛出异常，而是真正得到返回值。