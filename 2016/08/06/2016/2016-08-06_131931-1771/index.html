<!DOCTYPE html>
<html lang="zh-cmn-Hans">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>VS2015+WDK10+Win10 Win7以上系统驱动发开环境搭建 | Dylan&#39;s blog</title>
  
  
  
  <!--link rel="stylesheet" href="//cdn.jsdelivr.net/highlight.js/9.10.0/styles/github-gist.min.css"-->
  
<link rel="stylesheet" href="//cdn.jsdelivr.net/highlight.js/9.10.0/styles/github-gist.min.css">

  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 6.3.0"></head>

<body>
<div class="Shell">
    <aside class='SideBar'>
    <section class='avatar' style="background-image: url()">
        <div class='av-pic' style="background-image: url(https://avatars.githubusercontent.com/u/13995319?v=4)">
        </div>
    </section>
    <section class='menu'>
        <div>Dylan&#39;s blog</div>
        
            <div>To the pursuit of truth.</div>
        
        <ul>
          
            <a href="/" class="Btn">
              <li>Home</li>
            </a>  
          
            <a href="/archives/" class="Btn">
              <li>Archive</li>
            </a>  
          
        </ul>
    </section>
    <section class="media">
        
    </section>
</aside>

    <div class="container">
        <div data-pager-shell>
            <div>
  <article class='ContentView'>
    <header class='PageTitle'>
        <h1>VS2015+WDK10+Win10 Win7以上系统驱动发开环境搭建</h1>
    </header>

    <section>
      <p>文本主要介绍 Win10 系统下安装 VS2015 及 WDK10 驱动开发环境的搭建，搭建完成后可通过 VS2015 直接新建驱动项目并编译通过后可在 Win7 以上系统运行。无需自己制作模版等繁琐步骤（其实早在 VS2013+WDK8.1 的时候就已经支持直接从 IDE 中新建项目）。以下是相关截图：</p>
<span id="more"></span>
<p>可直接通过 VS 创建项目 <a href="/images/2016/08/2016-08-06_124501.png"><img src="/images/2016/08/2016-08-06_124501.png" alt="2016-08-06_124501"></a> 直接在 VS 中编译： <a href="/images/2016/08/2016-08-06_124622.png"><img src="/images/2016/08/2016-08-06_124622.png" alt="2016-08-06_124622"></a></p>
<h2 id="安装步骤"><a href="#安装步骤" class="headerlink" title="安装步骤"></a>安装步骤</h2><p>打开 <a target="_blank" rel="noopener" href="https://developer.microsoft.com/zh-cn/windows/hardware/windows-driver-kit">https://developer.microsoft.com/zh-cn/windows/hardware/windows-driver-kit</a> 页面，下载 VS2015 和 WDK10。 <a href="/images/2016/08/2016-08-06_125011.png"><img src="/images/2016/08/2016-08-06_125011.png" alt="2016-08-06_125011"></a> <a href="/images/2016/08/2016-08-06_125353.png"><img src="/images/2016/08/2016-08-06_125353.png" alt="2016-08-06_125353"></a> 根据你的需要下载对应版本的 VS2015，推荐下载 Community 版本，因为这个版本免费且功能齐全。安装包比较大，大概 7G 左右。下载完成后运行安装程序，选择 <code>Visual C++</code> 和 <code>Windows 10 SDK</code> <a href="/images/2016/08/2016-08-06_125128.png"><img src="/images/2016/08/2016-08-06_125128.png" alt="2016-08-06_125128"></a> <a href="/images/2016/08/2016-08-06_125154.png"><img src="/images/2016/08/2016-08-06_125154.png" alt="2016-08-06_125154"></a> VS2015 安装完成后，开始安装下载好的 WDK10，WDK10 是一个在线安装程序，可以直接安装也可以下载到本地再进行安装，我选择的是直接下载到本地： <a href="/images/2016/08/2016-08-06_125711.png"><img src="/images/2016/08/2016-08-06_125711.png" alt="2016-08-06_125711"></a> 等待下载完成后，到下载后的目录直接运行安装程序安装即可。</p>
<h2 id="开发设置"><a href="#开发设置" class="headerlink" title="开发设置"></a>开发设置</h2><p>VS2015 和 WDK 都安装完毕后，运行 VS2015，新建项目时就可以看到有 <code>Windows Driver</code> 的选项了，我们新建一个 WDK 的 Kernel Mode Driver 的空项目，然后新建一个 DriverEntry.c，里面写一些测试代码： <a href="/images/2016/08/2016-08-06_130027.png"><img src="/images/2016/08/2016-08-06_130027.png" alt="2016-08-06_130027"></a> <a href="/images/2016/08/2016-08-06_131650.png"><img src="/images/2016/08/2016-08-06_131650.png" alt="2016-08-06_131650"></a> 然后点击项目属性，修改如下几个选项： 修改警告等级为 3： <a href="/images/2016/08/2016-08-06_130436.png"><img src="/images/2016/08/2016-08-06_130436.png" alt="2016-08-06_130436"></a> 修改平台为 Windows7 Desktop： <a href="/images/2016/08/2016-08-06_130512.png"><img src="/images/2016/08/2016-08-06_130512.png" alt="2016-08-06_130512"></a> 关闭 inf2cat（详见 <a target="_blank" rel="noopener" href="http://blog.csdn.net/doublestarts/article/details/37922819">http://blog.csdn.net/doublestarts/article/details/37922819</a>）： <a href="/images/2016/08/2016-08-06_130547.png"><img src="/images/2016/08/2016-08-06_130547.png" alt="2016-08-06_130547"></a> 关闭为驱动添加数字签名 <a href="/images/2016/08/2016-08-06_130612.png"><img src="/images/2016/08/2016-08-06_130612.png" alt="2016-08-06_130612"></a> 然后编译驱动，我选择的是 x64 平台，如无问题，则会编译成功：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1&gt;------ 已启动生成: 项目: TestDriver, 配置: Debug x64 ------</span><br><span class="line">1&gt;  Building &#x27;TestDriver&#x27; with toolset &#x27;WindowsKernelModeDriver10.0&#x27; and the &#x27;Desktop&#x27; target platform.</span><br><span class="line">1&gt;  Stamping x64\Debug\TestDriver.inf [Version] section with DriverVer=08/06/2016,13.10.36.807</span><br><span class="line">1&gt;  DriverEntry.c</span><br><span class="line">1&gt;  TestDriver.vcxproj -&gt; d:\documents\visual studio 2015\Projects\TestDriver\x64\Debug\TestDriver.sys</span><br><span class="line">1&gt;  TestDriver.vcxproj -&gt; d:\documents\visual studio 2015\Projects\TestDriver\x64\Debug\TestDriver.pdb (Full PDB)</span><br><span class="line">========== 生成: 成功 1 个，失败 0 个，最新 0 个，跳过 0 个 ==========</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="测试驱动"><a href="#测试驱动" class="headerlink" title="测试驱动"></a>测试驱动</h2><p>找一台 Win7x64 开启了 DbgView 调试信息输出（见：<a target="_blank" rel="noopener" href="http://www.mycode.net.cn/platform/1765.html">修改注册表解决 Win7 DbgView 不显示调试信息</a>）的虚拟机，开机按 F8，选择“禁用驱动程序签名强制”的选项启动系统： <a href="/images/2016/08/2016-08-06_131237.png"><img src="/images/2016/08/2016-08-06_131237.png" alt="2016-08-06_131237"></a> 打开 DbgView 和驱动加载工具 InstDrv，将我们写好的驱动复制到虚拟机中，加载我们的驱动，成功后会打印驱动的注册表路径信息： <a href="/images/2016/08/2016-08-06_131805.png"><img src="/images/2016/08/2016-08-06_131805.png" alt="2016-08-06_131805"></a></p>


      

    </section>
    
      <section class='ArticleMeta'>
          <div>
            发布于&nbsp;
            <time datetime="2016-08-06T13:19:31.000Z" itemprop="datePublished">
              2016-08-06
            </time>
          </div>
          
            <div>
              tags: 
  <li class="meta-text">
  { <a href="/tags/Drivers/">Drivers</a> }
  </li>

  <li class="meta-text">
  { <a href="/tags/VisualStudio/">VisualStudio</a> }
  </li>


            </div>
          
      </section>
    
    
</article>

  
</div>

            <footer>
    <div>© 2023 - Dylan </div>
    <div>
        <span>
            Powered by <a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a>
        </span>
        ,
        <span>
            Theme - <a target="_blank" rel="noopener" href="https://github.com/nameoverflow/hexo-theme-icalm">Icalm</a>
        </span>
    </div>
</footer>

        </div>
    </div>
</div>

<script src="/js/pager/dist/singlepager.js"></script>

<script>
var sp = new Pager('data-pager-shell')

</script>
</body>
</html>